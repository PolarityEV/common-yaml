# Polarity Error Code Definitions
# Single source of truth for error codes across all platforms
# Supports: C (STM32), C (ESP32), Dart (Flutter)

project_name: "Polarity"
prefix: "POLARITY_ERR"
version: "1.1.0"

# Error Source Tracking (for app team visibility)
sources:
  - id: "STM32_VCU"
    description: "STM32 Vehicle Control Unit"
    location: "Main VCU firmware"

  - id: "LDU_MOTOR"
    description: "Large Drive Unit Motor Controller"
    location: "stm32-sine firmware (temporary)"
    note: "Will be replaced by STM32-HAL-LDU in future"

  - id: "ESP32_GATEWAY"
    description: "ESP32 BLE Gateway"
    location: "ESP32 VCU Bridge firmware"

# VCU Error Codes: 100-299
categories:
  I2C:
    range: [100, 109]
    description: "I2C communication errors"
    source: "STM32_VCU"
    errors:
      - name: "I2C_SLAVE_TX"
        code: 100
        description: "I2C slave transmit failed"
        severity: "error"

      - name: "I2C_SLAVE_RX"
        code: 101
        description: "I2C slave receive failed"
        severity: "error"

      - name: "I2C_LISTEN"
        code: 102
        description: "I2C listen mode activation failed"
        severity: "error"

      - name: "I2C_ERR_CBK"
        code: 103
        description: "I2C error callback triggered"
        severity: "error"

      - name: "I2C_SLAVE_TX_CPLT"
        code: 104
        description: "I2C slave transmit complete with error"
        severity: "error"

      - name: "I2C_SLAVE_RX_CPLT"
        code: 105
        description: "I2C slave receive complete with error"
        severity: "error"

      - name: "I2C_ENABLE"
        code: 109
        description: "I2C enable failed"
        severity: "error"

  CAN:
    range: [110, 139]
    description: "CAN bus communication errors"
    source: "STM32_VCU"
    errors:
      - name: "CAN1_INIT"
        code: 110
        description: "CAN1 initialization failed"
        severity: "critical"

      - name: "CAN2_INIT"
        code: 111
        description: "CAN2 initialization failed"
        severity: "critical"

      - name: "CAN3_INIT"
        code: 112
        description: "CAN3 initialization failed"
        severity: "critical"

      - name: "CAN1_FILTER"
        code: 113
        description: "CAN1 filter configuration failed"
        severity: "error"

      - name: "CAN2_FILTER"
        code: 114
        description: "CAN2 filter configuration failed"
        severity: "error"

      - name: "CAN3_FILTER"
        code: 115
        description: "CAN3 filter configuration failed"
        severity: "error"

      - name: "CAN1_EN"
        code: 116
        description: "CAN1 enable/start failed"
        severity: "critical"

      - name: "CAN2_EN"
        code: 117
        description: "CAN2 enable/start failed"
        severity: "critical"

      - name: "CAN3_EN"
        code: 118
        description: "CAN3 enable/start failed"
        severity: "critical"

      - name: "CAN1_NOTIFICATION"
        code: 119
        description: "CAN1 notification activation failed"
        severity: "error"

      - name: "CAN2_NOTIFICATION"
        code: 120
        description: "CAN2 notification activation failed"
        severity: "error"

      - name: "CAN3_NOTIFICATION"
        code: 121
        description: "CAN3 notification activation failed"
        severity: "error"

      - name: "CAN_RX_FIFO0"
        code: 130
        description: "CAN RX FIFO0 error"
        severity: "warning"

      - name: "CAN_RX_FIFO1"
        code: 131
        description: "CAN RX FIFO1 error"
        severity: "warning"

      - name: "CAN_RX_MSG"
        code: 132
        description: "CAN receive message failed"
        severity: "error"

      - name: "CAN_QUEUE_FULL"
        code: 133
        description: "CAN message queue overflow (messages dropped)"
        severity: "warning"

      - name: "CAN1_RX_MSG"
        code: 134
        description: "CAN1 receive message failed"
        severity: "error"

      - name: "CAN2_RX_MSG"
        code: 135
        description: "CAN2 receive message failed"
        severity: "error"

      - name: "CAN3_RX_MSG"
        code: 136
        description: "CAN3 receive message failed"
        severity: "error"

      - name: "CAN4_RX_MSG"
        code: 137
        description: "CAN4 receive message failed (reserved for future hardware)"
        severity: "error"

      - name: "CAN5_RX_MSG"
        code: 138
        description: "CAN5 receive message failed (reserved for future hardware)"
        severity: "error"

      - name: "CAN_RESERVED"
        code: 139
        description: "Reserved for future CAN errors"
        severity: "info"

  TIM:
    range: [140, 159]
    description: "Timer peripheral errors"
    source: "STM32_VCU"
    errors:
      - name: "TIM1"
        code: 140
        description: "Timer 1 operation failed"
        severity: "error"

      - name: "TIM2"
        code: 141
        description: "Timer 2 operation failed"
        severity: "error"

      - name: "TIM3"
        code: 142
        description: "Timer 3 operation failed"
        severity: "error"

      - name: "TIM4"
        code: 143
        description: "Timer 4 operation failed"
        severity: "error"

      - name: "TIM5"
        code: 144
        description: "Timer 5 operation failed"
        severity: "error"

      - name: "TIM6"
        code: 145
        description: "Timer 6 operation failed"
        severity: "error"

      - name: "TIM7"
        code: 146
        description: "Timer 7 operation failed"
        severity: "error"

      - name: "TIM8"
        code: 147
        description: "Timer 8 operation failed"
        severity: "error"

      - name: "TIM9"
        code: 148
        description: "Timer 9 operation failed"
        severity: "error"

      - name: "TIM10"
        code: 149
        description: "Timer 10 operation failed"
        severity: "error"

      - name: "TIM11"
        code: 150
        description: "Timer 11 operation failed"
        severity: "error"

      - name: "TIM12"
        code: 151
        description: "Timer 12 operation failed"
        severity: "error"

      - name: "TIM13"
        code: 152
        description: "Timer 13 operation failed"
        severity: "error"

  UART:
    range: [160, 169]
    description: "UART serial communication errors"
    source: "STM32_VCU"
    errors:
      - name: "UART1"
        code: 160
        description: "UART1 operation failed"
        severity: "error"

      - name: "UART2"
        code: 161
        description: "UART2 operation failed"
        severity: "error"

  VCU_GENERAL:
    range: [200, 249]
    description: "VCU general system errors"
    source: "STM32_VCU"
    errors:
      - name: "VCU_INIT"
        code: 200
        description: "VCU initialization failed"
        severity: "critical"

      - name: "DCDC"
        code: 210
        description: "DC-DC converter error"
        severity: "critical"

      - name: "BMS1"
        code: 211
        description: "BMS1 communication or fault"
        severity: "critical"

      - name: "BMS2"
        code: 212
        description: "BMS2 communication or fault"
        severity: "critical"

      - name: "BMS_OVERVOLTAGE"
        code: 220
        description: "BMS cell overvoltage detected (charging stopped)"
        severity: "critical"

      - name: "BMS_UNDERVOLTAGE"
        code: 221
        description: "BMS cell undervoltage detected (fault condition)"
        severity: "critical"

      - name: "BMS_EXCESSIVE_DELTA"
        code: 222
        description: "BMS cell voltage imbalance exceeds limit"
        severity: "warning"

      - name: "BMS_DATA_FAULT"
        code: 223
        description: "BMS data invalid or corrupted (all cells zero)"
        severity: "critical"

      - name: "CHARGER1_OBC_TIMEOUT"
        code: 230
        description: "Charger 1 OBC communication timeout"
        severity: "error"

      - name: "CHARGER1_DCDC_TIMEOUT"
        code: 231
        description: "Charger 1 DCDC communication timeout"
        severity: "warning"

      - name: "CHARGER3_OBC_TIMEOUT"
        code: 232
        description: "Charger 3 OBC communication timeout"
        severity: "error"

      - name: "CHARGER3_DCDC_TIMEOUT"
        code: 233
        description: "Charger 3 DCDC communication timeout"
        severity: "warning"

      - name: "CHARGER1_TX_FAIL"
        code: 234
        description: "Failed to transmit command to Charger 1"
        severity: "warning"

      - name: "CHARGER3_TX_FAIL"
        code: 235
        description: "Failed to transmit command to Charger 3"
        severity: "warning"

      - name: "CHARGER1_OBC_FAULT"
        code: 236
        description: "Charger 1 OBC hardware or temperature fault"
        severity: "error"

      - name: "CHARGER3_OBC_FAULT"
        code: 237
        description: "Charger 3 OBC hardware or temperature fault"
        severity: "error"

  MOTOR_LDU:
    range: [250, 299]
    description: "Motor controller and LDU errors"
    source: "LDU_MOTOR"
    can_id: "0x108"
    errors:
      - name: "MOTOR_OVERCURRENT"
        code: 250
        description: "Motor phase overcurrent detected"
        severity: "critical"
        sine_error_code: 1
        sine_error_name: "ERR_OVERCURRENT"
        sine_error_type: "ERROR_STOP"
        action: "Motor will shut down immediately"

      - name: "MOTOR_THROTTLE1"
        code: 251
        description: "Throttle sensor 1 fault"
        severity: "warning"
        sine_error_code: 2
        sine_error_name: "ERR_THROTTLE1"
        sine_error_type: "ERROR_DISPLAY"
        action: "Check throttle pedal wiring"

      - name: "MOTOR_THROTTLE2"
        code: 252
        description: "Throttle sensor 2 fault"
        severity: "warning"
        sine_error_code: 3
        sine_error_name: "ERR_THROTTLE2"
        sine_error_type: "ERROR_DISPLAY"
        action: "Check throttle pedal wiring"

      - name: "MOTOR_CANTIMEOUT"
        code: 253
        description: "Motor CAN communication timeout"
        severity: "critical"
        sine_error_code: 4
        sine_error_name: "ERR_CANTIMEOUT"
        sine_error_type: "ERROR_STOP"
        action: "Check CAN bus connections"

      - name: "MOTOR_EMCYSTOP"
        code: 254
        description: "Emergency stop triggered"
        severity: "critical"
        sine_error_code: 5
        sine_error_name: "ERR_EMCYSTOP"
        sine_error_type: "ERROR_STOP"
        action: "Check emergency stop circuit"

      - name: "MOTOR_MPROT"
        code: 255
        description: "Motor protection fault"
        severity: "critical"
        sine_error_code: 6
        sine_error_name: "ERR_MPROT"
        sine_error_type: "ERROR_STOP"
        action: "Motor protection triggered"

      - name: "MOTOR_DESAT"
        code: 256
        description: "Desaturation fault"
        severity: "critical"
        sine_error_code: 7
        sine_error_name: "ERR_DESAT"
        sine_error_type: "ERROR_STOP"
        action: "IGBT desaturation detected"

      - name: "MOTOR_OVERVOLTAGE"
        code: 257
        description: "DC bus overvoltage"
        severity: "critical"
        sine_error_code: 8
        sine_error_name: "ERR_OVERVOLTAGE"
        sine_error_type: "ERROR_STOP"
        action: "DC bus voltage too high"

      - name: "MOTOR_ENCODER"
        code: 258
        description: "Encoder failure"
        severity: "warning"
        sine_error_code: 9
        sine_error_name: "ERR_ENCODER"
        sine_error_type: "ERROR_DISPLAY"
        action: "Check encoder connections"

      - name: "MOTOR_PRECHARGE"
        code: 259
        description: "Precharge fault"
        severity: "critical"
        sine_error_code: 10
        sine_error_name: "ERR_PRECHARGE"
        sine_error_type: "ERROR_STOP"
        action: "Precharge circuit failed"

      - name: "MOTOR_TMPHSMAX"
        code: 260
        description: "Heatsink overtemperature"
        severity: "warning"
        sine_error_code: 11
        sine_error_name: "ERR_TMPHSMAX"
        sine_error_type: "ERROR_DERATE"
        action: "Motor will derate power"

      - name: "MOTOR_CURRENTLIMIT"
        code: 261
        description: "Current limit active"
        severity: "warning"
        sine_error_code: 12
        sine_error_name: "ERR_CURRENTLIMIT"
        sine_error_type: "ERROR_DERATE"
        action: "Motor power limited"

      - name: "MOTOR_PWMSTUCK"
        code: 262
        description: "PWM stuck fault"
        severity: "warning"
        sine_error_code: 13
        sine_error_name: "ERR_PWMSTUCK"
        sine_error_type: "ERROR_DISPLAY"
        action: "PWM output failure"

      - name: "MOTOR_HICUROFS1"
        code: 263
        description: "Current sensor 1 offset high"
        severity: "warning"
        sine_error_code: 14
        sine_error_name: "ERR_HICUROFS1"
        sine_error_type: "ERROR_DISPLAY"
        action: "Calibrate current sensor 1"

      - name: "MOTOR_HICUROFS2"
        code: 264
        description: "Current sensor 2 offset high"
        severity: "warning"
        sine_error_code: 15
        sine_error_name: "ERR_HICUROFS2"
        sine_error_type: "ERROR_DISPLAY"
        action: "Calibrate current sensor 2"

      - name: "MOTOR_HIRESOFS"
        code: 265
        description: "High-res encoder offset fault"
        severity: "warning"
        sine_error_code: 16
        sine_error_name: "ERR_HIRESOFS"
        sine_error_type: "ERROR_DISPLAY"
        action: "Calibrate high-res encoder"

      - name: "MOTOR_LORESAMP"
        code: 266
        description: "Low-res encoder amplitude fault"
        severity: "warning"
        sine_error_code: 17
        sine_error_name: "ERR_LORESAMP"
        sine_error_type: "ERROR_DISPLAY"
        action: "Check encoder signal quality"

      - name: "MOTOR_TMPMMAX"
        code: 267
        description: "Motor overtemperature"
        severity: "warning"
        sine_error_code: 18
        sine_error_name: "ERR_TMPMMAX"
        sine_error_type: "ERROR_DERATE"
        action: "Motor will derate power"

      - name: "MOTOR_CANCRC"
        code: 268
        description: "Motor CAN CRC error"
        severity: "critical"
        sine_error_code: 19
        sine_error_name: "ERR_CANCRC"
        sine_error_type: "ERROR_STOP"
        action: "CAN message corrupted"

      - name: "MOTOR_CANCOUNTER"
        code: 269
        description: "Motor CAN counter mismatch"
        severity: "critical"
        sine_error_code: 20
        sine_error_name: "ERR_CANCOUNTER"
        sine_error_type: "ERROR_STOP"
        action: "CAN message sequence error"

# Backward compatibility mapping (old names -> new names)
# This maintains compatibility with existing code during transition
legacy_mapping:
  SKUDAK_ERR_I2C_SLAVE_TX: POLARITY_ERR_I2C_SLAVE_TX
  SKUDAK_ERR_I2C_SLAVE_RX: POLARITY_ERR_I2C_SLAVE_RX
  SKUDAK_ERR_I2C_LISTEN: POLARITY_ERR_I2C_LISTEN
  SKUDAK_ERR_I2C_ERR_CBK: POLARITY_ERR_I2C_ERR_CBK
  SKUDAK_ERR_I2C_SLAVE_TX_CPLT: POLARITY_ERR_I2C_SLAVE_TX_CPLT
  SKUDAK_ERR_I2C_SLAVE_RX_CPLT: POLARITY_ERR_I2C_SLAVE_RX_CPLT
  SKUDAK_ERR_I2C_ENABLE: POLARITY_ERR_I2C_ENABLE
  SKUDAK_ERR_CAN1_INIT: POLARITY_ERR_CAN1_INIT
  SKUDAK_ERR_CAN2_INIT: POLARITY_ERR_CAN2_INIT
  SKUDAK_ERR_CAN3_INIT: POLARITY_ERR_CAN3_INIT
  SKUDAK_ERR_CAN1_FILTER: POLARITY_ERR_CAN1_FILTER
  SKUDAK_ERR_CAN2_FILTER: POLARITY_ERR_CAN2_FILTER
  SKUDAK_ERR_CAN3_FILTER: POLARITY_ERR_CAN3_FILTER
  SKUDAK_ERR_CAN1_EN: POLARITY_ERR_CAN1_EN
  SKUDAK_ERR_CAN2_EN: POLARITY_ERR_CAN2_EN
  SKUDAK_ERR_CAN3_EN: POLARITY_ERR_CAN3_EN
  SKUDAK_ERR_CAN1_NOTIFICATION: POLARITY_ERR_CAN1_NOTIFICATION
  SKUDAK_ERR_CAN2_NOTIFICATION: POLARITY_ERR_CAN2_NOTIFICATION
  SKUDAK_ERR_CAN3_NOTIFICATION: POLARITY_ERR_CAN3_NOTIFICATION
  SKUDAK_ERR_CAN_RX_FIFO0: POLARITY_ERR_CAN_RX_FIFO0
  SKUDAK_ERR_CAN_RX_FIFO1: POLARITY_ERR_CAN_RX_FIFO1
  SKUDAK_ERR_CAN_RX_MSG: POLARITY_ERR_CAN_RX_MSG
  SKUDAK_ERR_CAN_QUEUE_FULL: POLARITY_ERR_CAN_QUEUE_FULL
  SKUDAK_ERR_CAN1_RX_MSG: POLARITY_ERR_CAN1_RX_MSG
  SKUDAK_ERR_CAN2_RX_MSG: POLARITY_ERR_CAN2_RX_MSG
  SKUDAK_ERR_CAN3_RX_MSG: POLARITY_ERR_CAN3_RX_MSG
  SKUDAK_ERR_CAN4_RX_MSG: POLARITY_ERR_CAN4_RX_MSG
  SKUDAK_ERR_CAN5_RX_MSG: POLARITY_ERR_CAN5_RX_MSG
  SKUDAK_ERR_TIM1: POLARITY_ERR_TIM1
  SKUDAK_ERR_TIM2: POLARITY_ERR_TIM2
  SKUDAK_ERR_TIM3: POLARITY_ERR_TIM3
  SKUDAK_ERR_TIM4: POLARITY_ERR_TIM4
  SKUDAK_ERR_TIM5: POLARITY_ERR_TIM5
  SKUDAK_ERR_TIM6: POLARITY_ERR_TIM6
  SKUDAK_ERR_TIM7: POLARITY_ERR_TIM7
  SKUDAK_ERR_TIM8: POLARITY_ERR_TIM8
  SKUDAK_ERR_TIM9: POLARITY_ERR_TIM9
  SKUDAK_ERR_TIM10: POLARITY_ERR_TIM10
  SKUDAK_ERR_TIM11: POLARITY_ERR_TIM11
  SKUDAK_ERR_TIM12: POLARITY_ERR_TIM12
  SKUDAK_ERR_TIM13: POLARITY_ERR_TIM13
  SKUDAK_ERR_UART1: POLARITY_ERR_UART1
  SKUDAK_ERR_UART2: POLARITY_ERR_UART2
  SKUDAK_ERR_VCU_INIT: POLARITY_ERR_VCU_INIT
  SKUDAK_ERR_DCDC: POLARITY_ERR_DCDC
  SKUDAK_ERR_BMS1: POLARITY_ERR_BMS1
  SKUDAK_ERR_BMS2: POLARITY_ERR_BMS2
